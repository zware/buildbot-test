Fix race condition between signal delivery and wakeup file descriptor.
Patch by Nathaniel Smith.
